<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ecomm MVP Sandbox</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <!-- Header -->
    <header class="header">
        <img src="images/placeholder-header.png" alt="Header Image">
    </header>

    <!-- Start Multi-Step Form -->
    <section class="shop">
        <h1>Pick your customized solution</h1>

        <h2>We've built some options based on your answers.</h2>

        <!-- Shopify Embed -->
        <div class="products">
            <div class="product-card">
                <h2>DIY Kit</h2>
                <ul>
                    <li>Included Hardware : UV Light</li>
                    <li>Installation : Customer Self-Install</li>
                    <li>Delivery : Mailed to End Customer</li>
                    <li>Service/Maintenance Included : None</li>
                </ul>
                <div class="badge">This option requires you to install the air purifier yourself (or by a contractor).</div>
                <div id='product-component-1692659815127'></div>
                <script type="text/javascript">
                /*<![CDATA[*/
                (function () {
                var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
                if (window.ShopifyBuy) {
                    if (window.ShopifyBuy.UI) {
                    ShopifyBuyInit();
                    } else {
                    loadScript();
                    }
                } else {
                    loadScript();
                }
                function loadScript() {
                    var script = document.createElement('script');
                    script.async = true;
                    script.src = scriptURL;
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
                    script.onload = ShopifyBuyInit;
                }
                function ShopifyBuyInit() {
                    var client = ShopifyBuy.buildClient({
                    domain: 'leaf-home-aerovita.myshopify.com',
                    storefrontAccessToken: '7ff75655f44ceaf006e263ca79223ef8',
                    });
                    ShopifyBuy.UI.onReady(client).then(function (ui) {
                    ui.createComponent('product', {
                        id: '8533125923113',
                        node: document.getElementById('product-component-1692659815127'),
                        moneyFormat: '%24%7B%7Bamount%7D%7D',
                        options: {
                "product": {
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "calc(25% - 20px)",
                        "margin-left": "20px",
                        "margin-bottom": "50px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "contents": {
                    "img": false,
                    "title": false,
                    "price": false
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "productSet": {
                    "styles": {
                    "products": {
                        "@media (min-width: 601px)": {
                        "margin-left": "-20px"
                        }
                    }
                    }
                },
                "modalProduct": {
                    "contents": {
                    "img": false,
                    "imgWithCarousel": true,
                    "button": false,
                    "buttonWithQuantity": true
                    },
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "100%",
                        "margin-left": "0px",
                        "margin-bottom": "0px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "option": {},
                "cart": {
                    "styles": {
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "total": "Subtotal",
                    "button": "Checkout"
                    },
                    "popup": false
                },
                "toggle": {
                    "styles": {
                    "toggle": {
                        "background-color": "#414141",
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    }
                }
                },
                    });
                    });
                }
                })();
                /*]]>*/
                </script>
            </div>
            <div class="product-card">
                <h2>Premium Bundle</h2>
                <div class="badge">MOST POPULAR</div>
                <ul>
                    <li>Included Hardware : UV Light + HEPA Filter</li>
                    <li>Installation : LeafAir Tech Install</li>
                    <li>Delivery : LeafAir Tech Delivers on Installation</li>
                    <li>Service/Maintenance Included : One Year Scheduled Service on Both</li>
                </ul>
                <div id='product-component-1692660321187'></div>
                <script type="text/javascript">
                /*<![CDATA[*/
                (function () {
                var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
                if (window.ShopifyBuy) {
                    if (window.ShopifyBuy.UI) {
                    ShopifyBuyInit();
                    } else {
                    loadScript();
                    }
                } else {
                    loadScript();
                }
                function loadScript() {
                    var script = document.createElement('script');
                    script.async = true;
                    script.src = scriptURL;
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
                    script.onload = ShopifyBuyInit;
                }
                function ShopifyBuyInit() {
                    var client = ShopifyBuy.buildClient({
                    domain: 'leaf-home-aerovita.myshopify.com',
                    storefrontAccessToken: '7ff75655f44ceaf006e263ca79223ef8',
                    });
                    ShopifyBuy.UI.onReady(client).then(function (ui) {
                    ui.createComponent('product', {
                        id: '8533131231529',
                        node: document.getElementById('product-component-1692660321187'),
                        moneyFormat: '%24%7B%7Bamount%7D%7D',
                        options: {
                "product": {
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "calc(25% - 20px)",
                        "margin-left": "20px",
                        "margin-bottom": "50px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "contents": {
                    "img": false,
                    "title": false,
                    "price": false
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "productSet": {
                    "styles": {
                    "products": {
                        "@media (min-width: 601px)": {
                        "margin-left": "-20px"
                        }
                    }
                    }
                },
                "modalProduct": {
                    "contents": {
                    "img": false,
                    "imgWithCarousel": true,
                    "button": false,
                    "buttonWithQuantity": true
                    },
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "100%",
                        "margin-left": "0px",
                        "margin-bottom": "0px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "option": {},
                "cart": {
                    "styles": {
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "total": "Subtotal",
                    "button": "Checkout"
                    },
                    "popup": false
                },
                "toggle": {
                    "styles": {
                    "toggle": {
                        "background-color": "#414141",
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    }
                }
                },
                    });
                    });
                }
                })();
                /*]]>*/
                </script>
            </div>
            <div class="product-card">
                <h2>Service Bundle</h2>
                <ul>
                    <li>Included Hardware : UV Light</li>
                    <li>Installation : LeafAir Tech Install</li>
                    <li>Delivery : LeafAir Tech Delivers on Installation</li>
                    <li>Service/Maintenance Included : One Year Scheduled Service on Both</li>
                </ul>
                <div style="padding-top: 23px;" id='product-component-1692660371295'></div>
                <script type="text/javascript">
                /*<![CDATA[*/
                (function () {
                var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
                if (window.ShopifyBuy) {
                    if (window.ShopifyBuy.UI) {
                    ShopifyBuyInit();
                    } else {
                    loadScript();
                    }
                } else {
                    loadScript();
                }
                function loadScript() {
                    var script = document.createElement('script');
                    script.async = true;
                    script.src = scriptURL;
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
                    script.onload = ShopifyBuyInit;
                }
                function ShopifyBuyInit() {
                    var client = ShopifyBuy.buildClient({
                    domain: 'leaf-home-aerovita.myshopify.com',
                    storefrontAccessToken: '7ff75655f44ceaf006e263ca79223ef8',
                    });
                    ShopifyBuy.UI.onReady(client).then(function (ui) {
                    ui.createComponent('product', {
                        id: '8533132050729',
                        node: document.getElementById('product-component-1692660371295'),
                        moneyFormat: '%24%7B%7Bamount%7D%7D',
                        options: {
                "product": {
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "calc(25% - 20px)",
                        "margin-left": "20px",
                        "margin-bottom": "50px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "contents": {
                    "img": false,
                    "title": false,
                    "price": false
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "productSet": {
                    "styles": {
                    "products": {
                        "@media (min-width: 601px)": {
                        "margin-left": "-20px"
                        }
                    }
                    }
                },
                "modalProduct": {
                    "contents": {
                    "img": false,
                    "imgWithCarousel": true,
                    "button": false,
                    "buttonWithQuantity": true
                    },
                    "styles": {
                    "product": {
                        "@media (min-width: 601px)": {
                        "max-width": "100%",
                        "margin-left": "0px",
                        "margin-bottom": "0px"
                        }
                    },
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "button": "Add to cart"
                    }
                },
                "option": {},
                "cart": {
                    "styles": {
                    "button": {
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        "background-color": "#414141",
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    },
                    "text": {
                    "total": "Subtotal",
                    "button": "Checkout"
                    },
                    "popup": false
                },
                "toggle": {
                    "styles": {
                    "toggle": {
                        "background-color": "#414141",
                        ":hover": {
                        "background-color": "#3b3b3b"
                        },
                        ":focus": {
                        "background-color": "#3b3b3b"
                        }
                    }
                    }
                }
                },
                    });
                    });
                }
                })();
                /*]]>*/
                </script>
            </div>
        </div>
        <!-- End Shopify Embed -->



    </section>

    <!-- Main JS -->
    <script>

        function moveToStep(step) {
            if (step === 2) {
                var zipCode = document.getElementById('address').value;

                // Geocoding request to get latitude and longitude
                var geocoder = new google.maps.Geocoder();
                geocoder.geocode({ 'address': zipCode }, function (results, status) {
                    if (status === 'OK') {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(12);
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

                // Air quality API request
                var apiUrl = 'https://www.airnowapi.org/aq/forecast/zipCode/?format=text/csv&zipCode=' + zipCode + '&date=2023-08-10&distance=25&API_KEY=8B46027D-335B-45ED-B67B-22A5B1B8DF6A';

                // Fetch data from API
                fetch(apiUrl)
                    .then(response => response.text())
                    .then(data => {
                        var lines = data.split('\n');
                        var values = lines[1].split(',');
                        var location = values[2].replace(/"/g, ''); 
                        var aqi = values[7].replace(/"/g, ''); 
                        var actionDay = values[9].replace(/"/g, ''); 

                        document.getElementById('location').innerText = "" + location;
                        document.getElementById('aqi').innerText = "" + aqi;
                        document.getElementById('actionDay').innerText = "" + actionDay; 
                    })
                    .catch(error => {
                        console.error('There was an error fetching the air quality data:', error);
                    });

                // Show the loading page
                var steps = document.querySelectorAll('.step');
                for (var i = 0; i < steps.length; i++) {
                    steps[i].classList.remove('active');
                }
                steps[step - 1].classList.add('active');

                // Wait for 3 seconds before moving to the next step
                setTimeout(function () {
                    moveToStep(3);
                }, 3000);
                return; 
            }

            var steps = document.querySelectorAll('.step');
            for (var i = 0; i < steps.length; i++) {
                steps[i].classList.remove('active');
            }
            steps[step - 1].classList.add('active');
        }


        function submitForm() {
            alert('From here we continue to the final questions and begin Shopify integration steps.');
        }

        moveToStep(1); // Start at step 1
    </script>

    <!-- Initialize Google Map -->
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGWDxmNeNoxKUeh2H75dzMuNTtKQaBknI&callback=initMap&libraries=places">
        </script>

    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 37.0902, lng: -95.7129 },
                zoom: 4,
                mapTypeControl: false,
                streetViewControl: false,
                zoomControl: false,
                fullscreenControl: false,
                rotateControl: false,
                scaleControl: false
            });

            // Initialize autocomplete on the address input field
            var addressInput = document.getElementById('address');
            var autocomplete = new google.maps.places.Autocomplete(addressInput);
            autocomplete.setFields(['address_components', 'geometry']);

            // Event listener to capture the selected place
            autocomplete.addListener('place_changed', function () {
                var place = autocomplete.getPlace();
                if (place.geometry) {
                    // Extract the postal code (zip code) from the address components
                    var zipCode = null;
                    for (var i = 0; i < place.address_components.length; i++) {
                        var component = place.address_components[i];
                        if (component.types.indexOf('postal_code') !== -1) {
                            zipCode = component.long_name;
                            break;
                        }
                    }
                    if (zipCode) {
                        document.getElementById('address').value = zipCode; // Update the address input field with the zip code
                    }
                }
            });
        }
    </script>

</body>
</html>